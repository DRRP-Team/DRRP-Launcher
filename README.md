# DRRP-Launcher

## Некоторые заметки

### При первом запуске

- Все элементы отключены кроме блока настроек и кнопки "Установиться"

### При нажатии на кнопку "Установиться"

1. Собрать и провалидировать параметры блока настроек
2. Проверить главную папку
  - Если папки не существует или она пустая
    - Если папки не существует
      1. Проверить возможность создания папки
        - Если нет - выбросить ошибку
    2. Создать папку и подпапки
    3. Создать файл launcher.json
    4. Склонировать репозиторий DRRP
    - *Что лучше?*
    5. Прописать в реестр Software/DRRP-Launcher/main_folder путь к главной папке
    5. Создать в папке с exe'шником файл main_folder.json и прописать туда путь к главной папке
  - Если папка не пустая
    - Проверить главную папку()
3. Перезапуститься

### При запуске

1. Прочитать файл main_folder.json
  - Если нет - "При первом запуске"
2. Проверить главную папку()
3. Обновить списки
  - Если стоит галочка обновления при запуске
    1. При нажатии на кнопку обновления списка версий DRRP
    2. При нажатии на кнопку обновления списка версий GZDoom
  - Иначе
    1. Получить локальные версии DRRP()
    2. Получить локальные версии GZDoom()
4. Получить из launcher.json текущие версии DRRP и GZDoom для запуска
5. Обновить информацию о версии DRRP()

### При нажатии на кнопку обновления списка версий DRRP

1. Проверить наличие Git репозитория в папке DRRP
2. Сделать git fetch
3. Получить локальные версии DRRP()

### При нажатии на кнопку обновления списка версий GZDoom

1. Отправить запрос в API на получение списка доступных версий GZDoom
  - При ошибке выкинуть её в MsgBox
2. Распарсить список
  - При ошибке выкинуть её в MsgBox
3. Обновить combobox

### Получить локальные версии GZDoom()

1. Прочитать и распарсить список папок GZDoom
2. Обновить combobox

### Получить локальные версии DRRP()

1. Прочитать и распарсить список тегов
2. Обновить combobox

### Проверить главную папку()

1. Проверить наличие папок Engines, DRRP, файла launcher.json
  - Если чего-то не хватает - спросить о пересоздании папки
2. Проверить наличие .git репозитория в папке DRRP
  - Если нет - спросить о пересоздании папки
3. Проверить структуру launcher.json
  - Если нет - спросить о пересоздании файла

### Обновить информацию о версии DRRP() *Пока не надо*

1. Сериализировать имя тега
2. Получить ID коммита тега
3. Получить и распарсить информацию
4. Обновить label(ы)

### При нажати на кнопку запуска

1. Собрать и провалидировать параметры формы
2. Проверить наличие doom2.wad
  - Если doom2.wad отсутствует:
    1. Скачать с https://github.com/dgeng/iwad в главную папку (doom2.7z)
    2. Распаковать в главную папку (doom2.wad)
    3. Удалить doom2.7z
3. Сравнить версии DRRP
  - Если текущая версия и выбранная отличаются
    1. Сделать *pull? и* checkout на нужную версию
4. Проверить наличие папки с нужной версией GZDoom
  - Если нет
    1. Скачать нужную версию GZDoom в папку Engines
    2. Распаковать
    3. Удалить архив
5. {path_to_gzdoom.exe} -iwad {path_to_main_folder}/doom2.wad {path_to_main_folder}/DRRP {additional_flags}

### Структура каталогов главной папки:

- /
  - DRRP
    - .git
    - ...
  - Engines
    - GZDoom351
      - Здесь portable версия GZDoom
    - ...
  - launcher.json
  - doom2.wad

### Структура launcher.json

#### v0

```ts
interface iLauncherJson {
    version: number = 0; // Версия спецификации файла

    engines: Array<iEngine>;
    engine_version: number; // Выбранная версия GZDoom для запуска

    drrp_version: string; // "0.3.x"
    drrp_repository: string; // URL репозитория для клонирования

    api_engines: string; // API для получения списка GZDoom'ов со ссылками для скачивания

    update_on_load: boolean = true; // Обновлять ли список версий DRRP и GZDoom при запуске лаунчера
};

interface iEngine {
    version: number; // Версия GZDoom (3.5.1 -> 351, 3.5 -> 350)
    binary: string; // Путь к .exe файлу относительно главной папки
};
```

#### v? *(Поля, которые планируется добавить позже)*

```ts
interface iLauncherJson {
    language: "ru" | "en";
    engine: number;
};